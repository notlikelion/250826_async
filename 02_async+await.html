<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>5. Async Await</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      .container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid lightgray;
        border-radius: 8px;
      }
      button {
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
        margin: 5px;
      }
      #log {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid black;
        background-color: ghostwhite;
        min-height: 150px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>5. Async/Awaitë¡œ ë¹„ë™ê¸° ì½”ë“œ ë™ê¸°ì²˜ëŸ¼ ì‘ì„±í•˜ê¸°</h1>
      <p>
        Promise ê¸°ë°˜ ì½”ë“œë¥¼ ê°€ì¥ ê¹”ë”í•˜ê³  ì§ê´€ì ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.
      </p>
      <button id="start-btn">ì‘ì—… ì‹œì‘ (ì„±ê³µ)</button>
      <button id="fail-btn">ì‘ì—… ì‹œì‘ (ì‹¤íŒ¨)</button>
      <div id="log"></div>
    </div>

    <script>
      const startBtn = document.getElementById("start-btn");
      const failBtn = document.getElementById("fail-btn");
      const logDiv = document.getElementById("log");

      const log = (message, isError = false) => {
        logDiv.innerHTML += `<div style="color: ${
          isError ? "red" : "black"
        };">${message}</div>`;
      };

      /*
        ==================================================================================
        ğŸ¯ Async / Await ì´ë€?
        ==================================================================================
        - Promiseë¥¼ ë” ì‰½ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ 'ë¬¸ë²•ì  ì„¤íƒ•(Syntactic Sugar)'ì…ë‹ˆë‹¤.
        - async: í•¨ìˆ˜ ì•ì— ë¶™ì´ë©´ í•´ë‹¹ í•¨ìˆ˜ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        - await: async í•¨ìˆ˜ ì•ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, Promiseê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì½”ë“œ ì‹¤í–‰ì„ 'ê¸°ë‹¤ë¦½ë‹ˆë‹¤'.
                 ì™„ë£Œë˜ë©´ Promiseì˜ ê²°ê³¼ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        - ì¥ì : ë¹„ë™ê¸° ì½”ë“œë¥¼ ë™ê¸° ì½”ë“œì²˜ëŸ¼ ìˆœì°¨ì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆì–´ ê°€ë…ì„±ì´ ë§¤ìš° í–¥ìƒë©ë‹ˆë‹¤.
        - ì—ëŸ¬ ì²˜ë¦¬: Promiseì˜ .catch() ëŒ€ì‹ , ë™ê¸° ì½”ë“œì—ì„œì™€ ë™ì¼í•œ try...catch êµ¬ë¬¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        */

      // Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ê¸°ë³¸ ë¹„ë™ê¸° í•¨ìˆ˜ (ì´ì „ ì˜ˆì œì™€ ë™ì¼)
      function asyncTask(taskName, duration, shouldSucceed) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            if (shouldSucceed) {
              log(`âœ… '${taskName}' ì™„ë£Œ`);
              resolve(taskName);
            } else {
              log(`âŒ '${taskName}' ì‹¤íŒ¨`);
              reject(new Error(`'${taskName}'ì—ì„œ ë¬¸ì œ ë°œìƒ`));
            }
          }, duration);
        });
      }

      // async/awaitë¥¼ ì‚¬ìš©í•œ ë¹„ë™ê¸° ì‘ì—… íë¦„ ì œì–´
      async function runProcess(shouldFail) {
        // 1. awaitëŠ” Promiseì—ë§Œ ë¶™ì¼ ìˆ˜ ìˆë‹¤ (setTimeoutì€ Promiseê°€ ì•„ë‹˜;;;)
        // - ì§ì ‘ Promiseë¥¼ ì“°ëŠ” ê²½ìš°ëŠ”...
        // - 1. ëŒ€ê¸° ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ sleep, wait. setTimeout + Promise
        // - 2. Race, All. Promise.***.
        // -> async. function -> Promise. -> return => Promise(return)
        log("ğŸš€ ì‘ì—… í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...");

        // ğŸ§‘â€ğŸ’» ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
        // 1. try...catch...finally êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì—ëŸ¬ í•¸ë“¤ë§ êµ¬ì¡°ë¥¼ ë§Œë“­ë‹ˆë‹¤.
        // 2. try ë¸”ë¡ ì•ˆì—ì„œ:
        //    - awaitë¥¼ ì‚¬ìš©í•˜ì—¬ '1. ì‚¬ìš©ì ì¸ì¦' (1ì´ˆ, ì„±ê³µ) ì‘ì—…ì„ ê¸°ë‹¤ë¦¬ê³  ê²°ê³¼ë¥¼ ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
        //    - awaitë¥¼ ì‚¬ìš©í•˜ì—¬ '2. ë°ì´í„° ë¡œë“œ' (1ì´ˆ) ì‘ì—…ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. shouldFail ê°’ì— ë”°ë¼ ì„±ê³µ/ì‹¤íŒ¨ê°€ ê²°ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        //    - awaitë¥¼ ì‚¬ìš©í•˜ì—¬ '3. ê²°ê³¼ í™”ë©´ ë Œë”ë§' (1ì´ˆ, ì„±ê³µ) ì‘ì—…ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
        //    - ëª¨ë“  ì‘ì—…ì´ ì„±ê³µí–ˆìŒì„ ì•Œë¦¬ëŠ” ë¡œê·¸ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
        try {
          // {}.then
          const result1 = await asyncTask(
            "1. ì‚¬ìš©ì ì¸ì¦",
            Math.random() * 2000,
            !shouldFail
          );
          console.log(result1); // then. catch.
          log(`- ì¤‘ê°„ê²°ê³¼ : ${result1}`);
          // Promise.all? ë™ê¸°ì (ìˆœì„œì ) ì²˜ë¦¬
          const result2 = await asyncTask(
            "2. ë°ì´í„° ë¡œë“œ",
            Math.random() * 2000,
            !shouldFail
          );
          log(`- ì¤‘ê°„ê²°ê³¼ : ${result2}`);
          const result3 = await asyncTask(
            "3. ê²°ê³¼ í™”ë©´ ë Œë”ë§",
            Math.random() * 2000,
            !shouldFail
          );
          log(`- ì¤‘ê°„ê²°ê³¼ : ${result3}`);
          log("ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (e) {
          // 3. catch ë¸”ë¡ ì•ˆì—ì„œ:
          //    - ë°œìƒí•œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë¡œê·¸ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
          // {}.catch
          console.error(e.message);
        } finally {
          // 4. finally ë¸”ë¡ ì•ˆì—ì„œ:
          //    - ì‘ì—… í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” ë¡œê·¸ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
          // {}.finally
          log("ì‘ì—… í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ");
        }
      }

      startBtn.addEventListener("click", async () => {
        logDiv.innerHTML = "";
        runProcess(false); // ì‹¤íŒ¨ ì—†ì´ ì‹¤í–‰
      });

      failBtn.addEventListener("click", async () => {
        logDiv.innerHTML = "";
        runProcess(true); // ì¤‘ê°„ì— ì‹¤íŒ¨í•˜ë„ë¡ ì‹¤í–‰
      });

      // 1. Promise -> ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ await
      // 2. awaitë¥¼ ì•ˆë¶™ì´ê³  Promise í•¨ìˆ˜ -> Promise -> then, catch, all, raceë¥¼ í†µí•œ ì²˜ë¦¬ë¥¼ ê°•ì œ.
      // 3. function -> Promise await -> async.
      // => í•œê°œë¼ë„ await (ë™ê¸° ì²˜ë¦¬)ê°€ í•„ìš”í•œ async/Promiseê°€ ì„ì—¬ ìˆìœ¼ë©´ ëª¨ë‘ async.
    </script>
  </body>
</html>
