<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>4. Promise ë³‘ë ¬ ì²˜ë¦¬</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      .container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid lightgray;
        border-radius: 8px;
      }
      button {
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
        margin: 5px;
      }
      #log {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid black;
        background-color: ghostwhite;
        min-height: 150px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>4. Promise ë³‘ë ¬ ì²˜ë¦¬ (All, Race)</h1>
      <p>ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµí•©ë‹ˆë‹¤.</p>
      <button id="all-btn">Promise.all (ëª¨ë‘ ì™„ë£Œë  ë•Œê¹Œì§€)</button>
      <button id="race-btn">Promise.race (ê°€ì¥ ë¹ ë¥¸ í•˜ë‚˜ë§Œ)</button>
      <div id="log"></div>
    </div>

    <script>
      const allBtn = document.getElementById("all-btn");
      const raceBtn = document.getElementById("race-btn");
      const logDiv = document.getElementById("log");

      const log = (message) => {
        logDiv.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      };

      // ì´ë¦„ê³¼ ì§€ì—° ì‹œê°„ì„ ë°›ì•„ Promiseë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
      const delayedTask = (name, delay) =>
        new Promise((resolve) => {
          log(`'${name}' ì‘ì—… ì‹œì‘ (ì†Œìš”ì‹œê°„: ${delay / 1000}ì´ˆ)`);
          setTimeout(() => {
            log(`âœ… '${name}' ì‘ì—… ì™„ë£Œ`);
            resolve(name);
          }, delay);
        });

      /*
        ==================================================================================
        ğŸ¯ Promise.all: ëª¨ë“  ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°
        ==================================================================================
        - ì—¬ëŸ¬ ê°œì˜ Promiseë¥¼ ë°°ì—´ë¡œ ë°›ì•„, ëª¨ë“  Promiseê°€ ì„±ê³µ(fulfilled)í•˜ë©´ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
        - í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨(rejected)í•˜ë©´ ì¦‰ì‹œ ì „ì²´ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
        - ì‚¬ìš© ì˜ˆ: í˜ì´ì§€ ë Œë”ë§ì— í•„ìš”í•œ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ëª¨ë‘ ë°›ì•„ì˜¨ í›„ í™”ë©´ì„ ê·¸ë¦´ ë•Œ
        */
      allBtn.addEventListener("click", () => {
        logDiv.innerHTML = "";
        log("Promise.all í…ŒìŠ¤íŠ¸ ì‹œì‘...");

        // ğŸ§‘â€ğŸ’» ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
        // 1. delayedTask í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ 3ê°œì˜ Promiseê°€ ë‹´ê¸´ ë°°ì—´(tasks)ì„ ë§Œë“­ë‹ˆë‹¤.
        // delayedTask("API 1: ì‚¬ìš©ì ì •ë³´", 1500);
        // delayedTask("API 2: ìƒí’ˆ ëª©ë¡", 2000);
        // delayedTask("API 3: ê´‘ê³  ë°°ë„ˆ", 1000);
        const tasks = [
          delayedTask("API 1: ì‚¬ìš©ì ì •ë³´", 1500),
          delayedTask("API 2: ìƒí’ˆ ëª©ë¡", 10000),
          delayedTask("API 3: ê´‘ê³  ë°°ë„ˆ", 1000),
        ];
        //    - 'API 1: ì‚¬ìš©ì ì •ë³´', 1500ms
        //    - 'API 2: ìƒí’ˆ ëª©ë¡', 2000ms
        //    - 'API 3: ê´‘ê³  ë°°ë„ˆ', 1000ms
        // 2. Promise.all(tasks)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        Promise.all(tasks)
          // 3. .then()ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì‘ì—…ì´ ì„±ê³µí–ˆì„ ë•Œì˜ ê²°ê³¼ë¥¼ ë¡œê·¸ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
          .then((results) => {
            // ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ë©´ (ê°€ì¥ ê¸´ ê±´ 2ì´ˆ) -> ê²°ê³¼ê°€ ë°°ì—´ë¡œ í•œ ë²ˆì—~
            log(`Promise.all ì„±ê³µ! ${results.join(",")}`);
          })
          .catch((error) => {
            log(e.message);
          });
      });

      /*
        ==================================================================================
        ğŸ¯ Promise.race: ê°€ì¥ ë¹ ë¥¸ ì‘ì—…ë§Œ ê¸°ë‹¤ë¦¬ê¸°
        ==================================================================================
        - ì—¬ëŸ¬ ê°œì˜ Promiseë¥¼ ë°°ì—´ë¡œ ë°›ì•„, ê·¸ì¤‘ ê°€ì¥ ë¨¼ì € ì™„ë£Œ(ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨)ë˜ëŠ” Promiseì˜ ê²°ê³¼ë¥¼ ë”°ë¦…ë‹ˆë‹¤.
        - ì‚¬ìš© ì˜ˆ: ì—¬ëŸ¬ ì„œë²„ ì¤‘ ê°€ì¥ ì‘ë‹µì´ ë¹ ë¥¸ ì„œë²„ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, íŠ¹ì • ì‹œê°„ ë‚´ì— ì‘ë‹µì´ ì—†ìœ¼ë©´ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬í•  ë•Œ
        */
      raceBtn.addEventListener("click", () => {
        logDiv.innerHTML = "";
        log("Promise.race í…ŒìŠ¤íŠ¸ ì‹œì‘...");

        // ğŸ§‘â€ğŸ’» ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
        // 1. delayedTask í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ 3ê°œì˜ Promiseê°€ ë‹´ê¸´ ë°°ì—´(servers)ì„ ë§Œë“­ë‹ˆë‹¤.
        //    - 'ê°€ì¥ ëŠë¦° ì„œë²„', 2000ms
        //    - 'ë³´í†µ ì„œë²„', 1500ms
        //    - 'ê°€ì¥ ë¹ ë¥¸ ì„œë²„', 800ms
        const servers = [
          //   delayedTask("ê°€ì¥ ëŠë¦° ì„œë²„", 2000),
          //   delayedTask("ë³´í†µ ì„œë²„", 1500),
          //   delayedTask("ê°€ì¥ ë¹ ë¥¸ ì„œë²„", 800),
          //   delayedTask("ì‹±ê°€í´ ì„œë²„", Math.random() * 1000),
          //   delayedTask("ì¼ë³¸ ì„œë²„", Math.random() * 500),
          //   delayedTask("ë¯¸êµ­ ì„œë²„", Math.random() * 750),
          delayedTask("AWS ì„œë²„", Math.random() * 1000),
          delayedTask("Azure ì„œë²„", Math.random() * 1000),
          delayedTask("GCP ì„œë²„", Math.random() * 1000),
        ];
        // 2. Promise.race(servers)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        Promise.race(servers)
          // 3. .then()ì„ ì‚¬ìš©í•˜ì—¬ ê°€ì¥ ë¨¼ì € ì™„ë£Œëœ ì‘ì—…ì˜ ê²°ê³¼ë¥¼ ë¡œê·¸ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
          .then((result) => {
            log(`Promise.race ì„±ê³µ! ${result}`);
          });
      });
    </script>
  </body>
</html>
